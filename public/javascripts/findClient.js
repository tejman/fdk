// Generated by CoffeeScript 1.7.1
(function() {
  $(function() {

    /*
    ************** Function Definitions ***********
     */
    var getSearch, updateWidgets;
    getSearch = function(input) {
      return $.ajax({
        type: "GET",
        url: "/search",
        data: {
          input: input
        },
        success: function(data) {
          var elem, _i, _len, _ref;
          $("#search-results").empty();
          $("#search-filters").empty();
          $("#query-menu").empty();
          jade.render($("#query-menu")[0], "queryMenu", {
            label: "Showing Results For:",
            value: data.query
          });
          jade.render($("#search-filters")[0], "filterBar");
          updateWidgets();
          _ref = $(".slider-stat .ui-slider-segment:first-child");
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            elem = _ref[_i];
            $(elem).css("margin-left", "0");
          }
          return jade.render($("#search-results")[0], "results", data);
        }
      });
    };
    updateWidgets = function() {
      var $slider;
      $slider = $(".slider-stat");
      if ($slider.length) {
        return $slider.slider({
          animate: "fast",
          min: 0,
          max: 100,
          value: [10, 90],
          orientation: "horizontal",
          range: true,
          step: 10
        }).addSliderSegments($slider.slider("option").max);
      }
    };

    /*
    **************** AJAX Calls ********************
     */
    $.ajax({
      type: "GET",
      url: "/popRandomSchools",
      success: function(data) {
        return jade.render($("#search-results")[0], "results", data);
      }
    });
    $.ajax({
      type: "GET",
      url: "/popStateDropdown",
      success: function(data) {
        var newElem, obj, _i, _len, _results;
        _results = [];
        for (_i = 0, _len = data.length; _i < _len; _i++) {
          obj = data[_i];
          newElem = _.template("<option value='<%= stateAbbr %>'><%= stateFull %></option>");
          _results.push($("#browse-state").append(newElem(obj)));
        }
        return _results;
      }
    });

    /*
    **************** Event Handlers ********************
     */
    $("#search-button").on("click", function() {
      return getSearch($("#search-bar").val());
    });
    $("#search-bar").on("keypress", function(e) {
      if (e.keyCode === 13) {
        return getSearch($(this).val());
      }
    });
    $(document).on("click", ".result-item", function() {
      console.log("test");
      return window.location.replace("/schoolProfile/" + $(this).attr("data-id"));
    });
    return $(document).on("click", "#filter-button", function() {
      $("#search-filters").slideToggle({
        done: function() {
          return $("#search-filters").css("overflow", "visible");
        }
      });
      return $(".filter-actions").fadeToggle();
    });
  });

}).call(this);
